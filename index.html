<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>–ñ–µ—Å—Ç—ã —Ä—É–∫ –≤ –±—Ä–∞—É–∑–µ—Ä–µ ‚Äî –¥–µ–º–æ —Å MediaPipe</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="color-scheme" content="dark light" />
  <style>
    :root{
      --bg1: #0f1225;
      --bg2: #0c1b2a;
      --glass:#101528cc;
      --text:#e9ecf1;
      --muted:#a8b3c9;
      --accent1:#7c5cff;
      --accent2:#00d1ff;
      --accent3:#00ffa3;
      --danger:#ff5c7a;
      --ok:#4ade80;
      --warn:#fbbf24;
      --shadow: 0 10px 30px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.03);
      --radius: 18px;
      --ring: 0 0 0 2px rgba(255,255,255,.05), 0 0 0 6px rgba(124,92,255,.15);
      --grad: radial-gradient(1200px 600px at 20% -10%, rgba(124,92,255,.25), transparent 50%),
              radial-gradient(1200px 600px at 120% 10%, rgba(0,209,255,.18), transparent 55%),
              radial-gradient(900px 500px at 50% 130%, rgba(0,255,163,.15), transparent 50%),
              linear-gradient(180deg, var(--bg1), var(--bg2));
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Inter, "Helvetica Neue", Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      background: var(--grad) fixed;
      overflow-x:hidden;
    }

    /* Layout */
    .app{display:grid; grid-template-rows:auto 1fr auto; min-height:100dvh; gap:16px}
    header{
      position:sticky; top:0; z-index:50; backdrop-filter:saturate(130%) blur(10px);
      background:linear-gradient(180deg, rgba(16,21,40,.9), rgba(16,21,40,.6));
      border-bottom:1px solid rgba(255,255,255,.07);
    }
    .nav{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding:14px clamp(12px, 3vw, 28px);
      max-width:1200px; margin:0 auto;
    }
    .brand{display:flex; align-items:center; gap:12px; font-weight:700; letter-spacing:.2px}
    .logo{
      width:36px; height:36px; border-radius:12px; background:
      conic-gradient(from 180deg, var(--accent2), var(--accent1), var(--accent3), var(--accent2));
      box-shadow: var(--ring); position:relative; overflow:hidden;
    }
    .logo::after{
      content:""; position:absolute; inset:2px; border-radius:10px; background:linear-gradient(180deg, rgba(255,255,255,.18), rgba(255,255,255,.02));
      box-shadow: inset 0 0 40px rgba(255,255,255,.05);
    }
    .nav-right{display:flex; align-items:center; gap:8px; flex-wrap:wrap}
    .pill{
      display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px;
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.08); box-shadow:var(--shadow); font-size:12px; color:var(--muted);
    }
    .btn{
      appearance:none; border:0; border-radius:12px; padding:10px 14px; font-weight:600; color:#0b0f18; cursor:pointer;
      background:linear-gradient(180deg, #fff, #f1f5ff);
      transition: transform .12s ease, box-shadow .12s ease, background .3s ease;
      box-shadow:0 6px 20px rgba(124,92,255,.25), inset 0 1px 0 rgba(255,255,255,.7);
    }
    .btn:hover{transform:translateY(-1px)}
    .btn.secondary{
      color:var(--text); background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03)); border:1px solid rgba(255,255,255,.09);
      box-shadow:var(--shadow)
    }

    main{max-width:1200px; width:100%; margin:0 auto; padding: 0 clamp(12px, 3vw, 28px) 28px}
    .grid{
      display:grid; gap:18px;
      grid-template-columns: 1.1fr .9fr;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
    }

    /* Video + overlay */
    .stage{
      position:relative; border-radius: var(--radius);
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.08); box-shadow: var(--shadow); overflow:hidden; min-height: 420px;
    }
    .video-wrap{
      position:relative; aspect-ratio: 16/10; width:100%; background:#000; overflow:hidden;
    }
    video{
      position:absolute; inset:0; width:100%; height:100%; object-fit:cover; transform: scaleX(-1);
      filter:saturate(105%) contrast(105%) brightness(102%);
    }
    canvas.overlay{
      position:absolute; inset:0; width:100%; height:100%; pointer-events:none;
    }
    .statusbar{
      position:absolute; left:12px; bottom:12px; display:flex; gap:8px; align-items:center; padding:8px 12px; border-radius:999px;
      background:rgba(10,14,24,.6); border:1px solid rgba(255,255,255,.08); color:var(--muted); font-size:12px; backdrop-filter: blur(8px);
    }
    .dot{width:10px;height:10px;border-radius:999px;background:var(--warn); box-shadow:0 0 0 3px rgba(251,191,36,.25)}
    .dot.ok{background:var(--ok); box-shadow:0 0 0 3px rgba(74,222,128,.25)}
    .dot.err{background:var(--danger); box-shadow:0 0 0 3px rgba(255,92,122,.25)}
    .fps{font-variant-numeric: tabular-nums;}

    /* Right panel */
    .panel{display:grid; gap:16px}
    .card{
      border-radius: var(--radius);
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.08);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card h3{margin:0; padding:14px 16px; font-size:14px; letter-spacing:.3px; color:#e8ebf3; border-bottom:1px solid rgba(255,255,255,.07);
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
    }
    .card .content{padding:16px; display:grid; gap:12px}

    /* Gesture nav */
    .gnav{display:flex; gap:10px; flex-wrap:wrap}
    .gitem{
      flex:1 1 120px; min-width:120px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding:12px 14px; border-radius:12px; cursor:pointer; user-select:none;
      border:1px solid rgba(255,255,255,.08);
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      transition:transform .12s ease, border-color .2s ease, background .2s ease;
    }
    .gitem.active{
      background:linear-gradient(180deg, rgba(0,255,163,.18), rgba(0,255,163,.05));
      border-color: rgba(0,255,163,.35);
      box-shadow: 0 8px 24px rgba(0,255,163,.15), inset 0 1px 0 rgba(255,255,255,.1);
    }
    .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      font-size:12px; padding:2px 8px; border-radius:8px;
      background:linear-gradient(180deg, rgba(255,255,255,.15), rgba(255,255,255,.05));
      border:1px solid rgba(255,255,255,.2); color:#121726;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.5);
    }

    /* Buttons with dwell-activate */
    .btns{display:grid; grid-template-columns: repeat(3, 1fr); gap:10px}
    @media (max-width:520px){ .btns{grid-template-columns:1fr 1fr} }
    .hbtn{
      position:relative; overflow:hidden; border-radius:14px; padding:14px; text-align:center; font-weight:700; cursor:pointer;
      border:1px solid rgba(255,255,255,.08);
      background:
       radial-gradient(160% 160% at 0% 0%, rgba(124,92,255,.18), transparent 40%),
       linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      transition: transform .12s ease, box-shadow .2s ease, border-color .2s ease;
    }
    .hbtn:hover{transform:translateY(-1px)}
    .hbtn.active{
      border-color: rgba(0,255,163,.4);
      background:
        radial-gradient(160% 160% at 100% 0%, rgba(0,255,163,.25), transparent 40%),
        linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.03));
      box-shadow:0 12px 30px rgba(0,255,163,.18);
    }
    .hbtn .sub{display:block; font-weight:600; font-size:12px; color:var(--muted); margin-top:4px}

    /* Sliders */
    .sliders{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    @media (max-width:700px){ .sliders{grid-template-columns:1fr} }
    .slider{
      position:relative; height:46px; border-radius:12px; padding: 10px 12px;
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.08);
      display:flex; align-items:center; gap:12px;
    }
    .track{position:relative; height:8px; flex:1; border-radius:999px; background:rgba(255,255,255,.08); overflow:hidden}
    .fill{position:absolute; inset:0 100% 0 0; background:linear-gradient(90deg, var(--accent2), var(--accent1));}
    .thumb{
      position:absolute; top:50%; transform:translate(-50%,-50%); width:20px; height:20px; border-radius:999px; background:#fff;
      box-shadow:0 4px 10px rgba(0,0,0,.3); border:2px solid #111827;
      transition: box-shadow .12s ease;
    }
    .slider:hover .thumb{box-shadow:0 6px 16px rgba(0,0,0,.4)}

    /* Drawing pad */
    .pad{
      position:relative; border-radius:14px; overflow:hidden; border:1px solid rgba(255,255,255,.09); background:#0b0f18;
      min-height:280px;
    }
    canvas#draw{display:block; width:100%; height:320px; background:
      linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));}
    .pad .tools{
      position:absolute; top:10px; right:10px; display:flex; gap:8px; z-index:5;
      background:rgba(10,14,24,.6); border:1px solid rgba(255,255,255,.1); padding:8px; border-radius:10px; backdrop-filter: blur(8px);
    }
    .tool{width:32px;height:32px;border-radius:9px;display:grid;place-items:center;cursor:pointer;
      background:linear-gradient(180deg, rgba(255,255,255,.16), rgba(255,255,255,.06)); border:1px solid rgba(255,255,255,.18)}
    .tool.active{outline:2px solid rgba(0,209,255,.6)}
    .badge{
      display:inline-flex; align-items:center; gap:6px; padding:8px 10px; border-radius:10px; font-size:12px; color:var(--muted);
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.08)
    }

    /* On-screen pointer */
    .cursor{
      position:absolute; width:28px; height:28px; border-radius:999px; pointer-events:none;
      border:2px solid rgba(255,255,255,.9); box-shadow: 0 0 0 6px rgba(124,92,255,.15);
      transform:translate(-50%,-50%); mix-blend-mode:difference; z-index:20;
    }
    .cursor .progress{
      position:absolute; inset:-4px; border-radius:999px; background:
      conic-gradient(var(--accent3) 0deg, rgba(255,255,255,.15) 0deg);
      mask: radial-gradient(circle, transparent 63%, black 64%);
      transition: background .08s linear;
    }
    .cursor.hidden{opacity:.25}

    .legend{display:grid; gap:8px; font-size:13px; color:var(--muted)}
    .legend li{display:flex; gap:10px; align-items:flex-start}
    .legend .dot{flex:0 0 10px; margin-top:5px}

    /* Error / fallback */
    .overlay-msg{
      position:absolute; inset:0; display:none; place-items:center; text-align:center; padding:24px; background:
      linear-gradient(180deg, rgba(10,14,24,.85), rgba(10,14,24,.6));
      border:1px dashed rgba(255,255,255,.12); border-radius: var(--radius); z-index:30;
    }
    .overlay-msg.show{display:grid}
    .overlay-msg .box{
      max-width:560px; padding:18px; border-radius:14px; background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.08); box-shadow:var(--shadow)
    }

    footer{padding:14px clamp(12px, 3vw, 28px); color:var(--muted); font-size:12px; text-align:center; opacity:.9}

    /* Fancy little glow animation */
    @keyframes pulseGlow {
      0%{box-shadow: 0 10px 30px rgba(0,209,255,.20), 0 0 0 0 rgba(0,209,255,.35)}
      70%{box-shadow: 0 10px 30px rgba(0,209,255,.10), 0 0 0 16px rgba(0,209,255,0)}
      100%{box-shadow: 0 10px 30px rgba(0,209,255,.20), 0 0 0 0 rgba(0,209,255,.35)}
    }
    .pulse{animation:pulseGlow 2.6s infinite}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="nav">
        <div class="brand">
          <div class="logo"></div>
          <div>
            <div style="font-size:14px; opacity:.9">–î–µ–º–æ –∂–µ—Å—Ç–æ–≤</div>
            <div style="font-size:12px; color:var(--muted)">MediaPipe Hand Landmarker ‚Ä¢ WebGL ‚Ä¢ wasm</div>
          </div>
        </div>
        <div class="nav-right">
          <span class="pill" id="perm-pill">–°—Ç–∞—Ç—É—Å –∫–∞–º–µ—Ä—ã: <strong style="margin-left:6px" id="perm-state">–∑–∞–ø—Ä–æ—Å‚Ä¶</strong></span>
          <button class="btn secondary" id="toggle-cam">–û—Ç–∫–ª—é—á–∏—Ç—å –∫–∞–º–µ—Ä—É</button>
          <button class="btn" id="toggle-mouse">–†–µ–∂–∏–º –º—ã—à–∏</button>
        </div>
      </div>
    </header>

    <main>
      <div class="grid">
        <!-- LEFT: video + overlay and instructions -->
        <section class="stage">
          <div class="video-wrap" id="video-wrap">
            <video id="webcam" playsinline autoplay muted></video>
            <canvas class="overlay" id="overlay"></canvas>
            <div class="cursor" id="cursor">
              <div class="progress" id="cursorProgress"></div>
            </div>
            <div class="statusbar">
              <span class="dot" id="detect-dot" title="–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ä—É–∫"></span>
              <span class="fps" id="fps">0 FPS</span>
              <span class="pill" id="hands-info">–†—É–∫–∏: 0</span>
            </div>

            <div class="overlay-msg" id="fallback">
              <div class="box">
                <h2 style="margin:0 0 8px 0">–ö–∞–º–µ—Ä–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞</h2>
                <p style="margin:0 0 10px 0; color:var(--muted)">–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –±—Ä–∞—É–∑–µ—Ä–∞ –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ ¬´–†–µ–∂–∏–º –º—ã—à–∏¬ª –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –±–µ–∑ –∫–∞–º–µ—Ä—ã.</p>
                <div style="display:flex; gap:10px; justify-content:center; margin-top:12px">
                  <button class="btn" id="ask-permission">–ó–∞–ø—Ä–æ—Å–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ</button>
                  <button class="btn secondary" id="enable-mouse-fallback">–í–∫–ª—é—á–∏—Ç—å —Ä–µ–∂–∏–º –º—ã—à–∏</button>
                </div>
                <ul class="legend" style="margin-top:14px; text-align:left">
                  <li><span class="dot ok"></span><span>–¢—Ä–µ–±—É–µ—Ç—Å—è HTTPS/localhost –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä (Chrome/Edge/Safari/Firefox).</span></li>
                  <li><span class="dot warn"></span><span>–ï—Å–ª–∏ –Ω–æ—É—Ç–±—É–∫ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∫–∞–º–µ—Ä–∞–º–∏ ‚Äî –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω—É—é –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±—Ä–∞—É–∑–µ—Ä–∞.</span></li>
                </ul>
              </div>
            </div>
          </div>

          <div class="card" style="margin:12px 12px 0">
            <h3>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∂–µ—Å—Ç–∞–º</h3>
            <div class="content">
              <ul class="legend">
                <li><span class="dot ok"></span><span><b>–ù–∞–≤–µ–¥–µ–Ω–∏–µ</b>: –Ω–∞–≤–µ–¥–∏—Ç–µ —É–∫–∞–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞–ª–µ—Ü –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç ‚Äî –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –≤–æ–∫—Ä—É–≥ –∫—É—Ä—Å–æ—Ä–∞ –∑–∞–ø–æ–ª–Ω–∏—Ç—Å—è –∏ —ç–ª–µ–º–µ–Ω—Ç –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è.</span></li>
                <li><span class="dot ok"></span><span><b>–ü–∏–Ω—á (—â–µ–ø–æ—Ç–∫–∞)</b> (–±–æ–ª—å—à–æ–π + —É–∫–∞–∑–∞—Ç–µ–ª—å–Ω—ã–π) ‚Äî —Ä–µ–∂–∏–º ¬´—Å—Ö–≤–∞—Ç–∏—Ç—å¬ª: –ø–µ—Ä–µ–º–µ—â–∞–π—Ç–µ –ø–∞–ª–µ—Ü –≤–¥–æ–ª—å —Å–ª–∞–π–¥–µ—Ä–∞ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è –∏–ª–∏ —Ä–∏—Å—É–π—Ç–µ –Ω–∞ —Ö–æ–ª—Å—Ç–µ.</span></li>
                <li><span class="dot ok"></span><span><b>–û—Ç–∫—Ä—ã—Ç–∞—è –ª–∞–¥–æ–Ω—å</b> ‚Äî –æ—Ç–∫—Ä—ã—Ç—å/–ø–æ–¥—Å–≤–µ—Ç–∏—Ç—å –º–µ–Ω—é –Ω–∞–≤–∏–≥–∞—Ü–∏–∏; <b>–∫—É–ª–∞–∫</b> ‚Äî —Å–≤–µ—Ä–Ω—É—Ç—å.</span></li>
                <li><span class="dot ok"></span><span><b>–°–≤–∞–π–ø</b> (–±—ã—Å—Ç—Ä–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –≤–ø—Ä–∞–≤–æ/–≤–ª–µ–≤–æ) ‚Äî –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø—É–Ω–∫—Ç–æ–≤ –º–µ–Ω—é.</span></li>
                <li><span class="dot warn"></span><span>–ü–æ–¥—Å–∫–∞–∑–∫–∞: –¥–µ—Ä–∂–∏—Ç–µ —Ä—É–∫—É –≤ —Ü–µ–Ω—Ç—Ä–µ –∫–∞–¥—Ä–∞ –Ω–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–∏ ~40‚Äì60 —Å–º –æ—Ç –∫–∞–º–µ—Ä—ã. –ö–∞—Ä—Ç–∏–Ω–∫–∞ –∑–µ—Ä–∫–∞–ª—å–Ω–∞—è ‚Äî –∫–∞–∫ –≤ —Å–µ–ª—Ñ–∏-–∫–∞–º–µ—Ä–µ.</span></li>
              </ul>
            </div>
          </div>
        </section>

        <!-- RIGHT: interactive controls -->
        <aside class="panel">
          <div class="card">
            <h3>–ù–∞–≤–∏–≥–∞—Ü–∏—è –∂–µ—Å—Ç–∞–º–∏</h3>
            <div class="content">
              <div class="gnav" id="gnav">
                <div class="gitem active" data-index="0"><span>–ì–ª–∞–≤–Ω–∞—è</span><span class="kbd">–ª–∞–¥–æ–Ω—å</span></div>
                <div class="gitem" data-index="1"><span>–ì–∞–ª–µ—Ä–µ—è</span><span class="kbd">—Å–≤–∞–π–ø ‚ñ∂</span></div>
                <div class="gitem" data-index="2"><span>–ü–ª–µ–µ—Ä</span><span class="kbd">—Å–≤–∞–π–ø ‚óÄ</span></div>
                <div class="gitem" data-index="3"><span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span><span class="kbd">‚úä</span></div>
              </div>
              <div class="badge" id="nav-state"><span class="dot"></span><span>–£–ø—Ä–∞–≤–ª—è–π—Ç–µ: –ª–∞–¥–æ–Ω—å/—Å–≤–∞–π–ø/–∫—É–ª–∞–∫</span></div>
            </div>
          </div>

          <div class="card">
            <h3>–ö–Ω–æ–ø–∫–∏ (hover-–∞–∫—Ç–∏–≤–∞—Ü–∏—è)</h3>
            <div class="content">
              <div class="btns" id="hoverBtns">
                <div class="hbtn" data-action="like">–ù—Ä–∞–≤–∏—Ç—Å—è ‚ù§Ô∏è<span class="sub">–ù–∞–≤–µ—Å—Ç–∏ –∏ —É–¥–µ—Ä–∂–∞—Ç—å</span></div>
                <div class="hbtn" data-action="spark">–°–≤–µ—Ä–∫–∞–Ω–∏–µ ‚ú®<span class="sub">–ù–∞–≤–µ—Å—Ç–∏ –∏ —É–¥–µ—Ä–∂–∞—Ç—å</span></div>
                <div class="hbtn" data-action="boom">–ë—É–º üí•<span class="sub">–ù–∞–≤–µ—Å—Ç–∏ –∏ —É–¥–µ—Ä–∂–∞—Ç—å</span></div>
              </div>
              <div class="badge" id="btn-log"><span class="dot"></span><span>–û–∂–∏–¥–∞—é –∂–µ—Å—Ç‚Ä¶</span></div>
            </div>
          </div>

          <div class="card">
            <h3>–°–ª–∞–π–¥–µ—Ä—ã (–ø–∏–Ω—á + –¥–≤–∏–∂–µ–Ω–∏–µ)</h3>
            <div class="content sliders">
              <div class="slider" data-name="–Ø—Ä–∫–æ—Å—Ç—å" id="sliderA">
                <span style="min-width:86px">–Ø—Ä–∫–æ—Å—Ç—å</span>
                <div class="track"><div class="fill"></div><div class="thumb"></div></div>
                <span class="val">50%</span>
              </div>
              <div class="slider" data-name="–ù–∞—Å—ã—â–µ–Ω–Ω–æ—Å—Ç—å" id="sliderB">
                <span style="min-width:86px">–ù–∞—Å—ã—â–µ–Ω–Ω–æ—Å—Ç—å</span>
                <div class="track"><div class="fill"></div><div class="thumb"></div></div>
                <span class="val">50%</span>
              </div>
              <div class="badge"><span class="dot ok"></span><span>–°–æ–∂–º–∏—Ç–µ –±–æ–ª—å—à–æ–π –∏ —É–∫–∞–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞–ª—å—Ü—ã, –Ω–∞–≤–µ–¥–∏—Ç–µ –Ω–∞ —Ç—Ä–µ–∫ –∏ –ø–µ—Ä–µ–º–µ—â–∞–π—Ç–µ –≤–¥–æ–ª—å.</span></div>
            </div>
          </div>

          <div class="card">
            <h3>–•–æ–ª—Å—Ç –¥–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è (—É–∫–∞–∑–∞—Ç–µ–ª—å–Ω—ã–π + –ø–∏–Ω—á)</h3>
            <div class="content">
              <div class="pad">
                <div class="tools">
                  <div class="tool active" data-tool="pen" title="–ö–∞—Ä–∞–Ω–¥–∞—à üñäÔ∏è">üñäÔ∏è</div>
                  <div class="tool" data-tool="high" title="–ú–∞—Ä–∫–µ—Ä ‚úçÔ∏è">‚úçÔ∏è</div>
                  <div class="tool" data-tool="rainbow" title="–†–∞–¥—É–≥–∞ üåà">üåà</div>
                  <div class="tool" data-tool="erase" title="–õ–∞—Å—Ç–∏–∫ üßΩ">üßΩ</div>
                  <div class="tool" data-tool="clear" title="–û—á–∏—Å—Ç–∏—Ç—å üóëÔ∏è">üóëÔ∏è</div>
                </div>
                <canvas id="draw" width="900" height="320"></canvas>
              </div>
              <div class="badge"><span class="dot ok"></span><span>–°–æ–∂–º–∏—Ç–µ –ø–∞–ª—å—Ü—ã, —á—Ç–æ–±—ã —Ä–∏—Å–æ–≤–∞—Ç—å. –†–∞–∑–æ–∂–º–∏—Ç–µ ‚Äî —á—Ç–æ–±—ã –∑–∞–≤–µ—Ä—à–∏—Ç—å —à—Ç—Ä–∏—Ö.</span></div>
            </div>
          </div>
        </aside>
      </div>
    </main>

    <footer>
      –≠—Ç–æ—Ç –ø—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç —Ü–µ–ª–∏–∫–æ–º –≤ –±—Ä–∞—É–∑–µ—Ä–µ. –ú–æ–¥–µ–ª—å MediaPipe –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–∑ CDN (WebAssembly). –ù–∏–∫–∞–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö —Å –∫–∞–º–µ—Ä—ã –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä.
    </footer>
  </div>

  <!-- MediaPipe Tasks Vision: Hand Landmarker (wasm) -->
  <script type="module">
    // ============================ –ò–º–ø–æ—Ä—Ç –º–æ–¥–µ–ª–∏ ============================
    import {
      HandLandmarker,
      FilesetResolver,
      DrawingUtils
    } from "https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest";

    // ============================ DOM-—Å—Å—ã–ª–∫–∏ ============================
    const video = document.getElementById("webcam");
    const overlay = document.getElementById("overlay");
    const ctx = overlay.getContext("2d");
    const cursor = document.getElementById("cursor");
    const cursorProgress = document.getElementById("cursorProgress");
    const detectDot = document.getElementById("detect-dot");
    const fpsEl = document.getElementById("fps");
    const handsInfo = document.getElementById("hands-info");
    const fallback = document.getElementById("fallback");
    const askPermBtn = document.getElementById("ask-permission");
    const enableMouseFallback = document.getElementById("enable-mouse-fallback");
    const permState = document.getElementById("perm-state");
    const permPill = document.getElementById("perm-pill");
    const toggleCamBtn = document.getElementById("toggle-cam");
    const toggleMouseBtn = document.getElementById("toggle-mouse");

    const gnav = document.getElementById("gnav");
    const navState = document.getElementById("nav-state");
    const hoverBtns = document.getElementById("hoverBtns");
    const btnLog = document.getElementById("btn-log");

    const drawCanvas = document.getElementById("draw");
    const dctx = drawCanvas.getContext("2d", { willReadFrequently: false });

    // ============================ –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è ============================
    let vision, handLandmarker, drawingUtils;
    let running = true;
    let mouseMode = false;          // fallback-—Ä–µ–∂–∏–º
    let modelReady = false;
    let initialized = false;
    let videoStream = null;

    // —Ä–∞–∑–º–µ—Ä—ã
    let vw = 1280, vh = 720;        // —Ä–∞–∑–º–µ—Ä –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –≤–∏–¥–µ–æ–ø–æ—Ç–æ–∫–∞ (–æ–±–Ω–æ–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ play)
    let overlayRect = { left: 0, top: 0, width: 0, height: 0 };

    // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∂–µ—Å—Ç–æ–≤
    const SMOOTH = 0.35;            // —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ –∫—É—Ä—Å–æ—Ä–∞ (0..1), –±–æ–ª—å—à–µ = –ø–ª–∞–≤–Ω–µ–µ
    const PINCH_TH = 0.05;          // –ø–æ—Ä–æ–≥ —â–µ–ø–æ—Ç–∫–∏ (–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ)
    const DWELL_MS = 600;           // —É–¥–µ—Ä–∂–∞–Ω–∏–µ –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∫–Ω–æ–ø–æ–∫ (–º—Å)
    const SWIPE_VX = 1.2;           // –ø–æ—Ä–æ–≥ —Å–∫–æ—Ä–æ—Å—Ç–∏ –¥–ª—è —Å–≤–∞–π–ø–∞ (–Ω–æ—Ä–º–∞–ª–∏–∑. –µ–¥/—Å–µ–∫)
    const NEAR_PX = 60;             // "–±–ª–∏–∑–æ—Å—Ç—å" –∫—É—Ä—Å–æ—Ä–∞ –∫ –∫–æ–Ω—Ç—Ä–æ–ª—É (px)

    // –ö—É—Ä—Å–æ—Ä –∏ –∏—Å—Ç–æ—Ä–∏–∏
    let pointer = { x: 0.5, y: 0.5, px: 0, py: 0 }; // –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ 0..1
    let pointerPx = { x: 0, y: 0 };  // –≤ –ø–∏–∫—Å–µ–ª—è—Ö, –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã overlay
    let vHist = [];                  // –∏—Å—Ç–æ—Ä–∏—è —Å–∫–æ—Ä–æ—Å—Ç–µ–π –¥–ª—è —Å–≤–∞–π–ø–∞
    let lastT = 0;

    // –ñ–µ—Å—Ç—ã
    let pinch = false;
    let fingersExtended = 0;
    let swipeCooldown = 0;

    // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
    let dwellTarget = null;
    let dwellStart = 0;
    let selectedNav = 0;

    // –°–ª–∞–π–¥–µ—Ä—ã
    const sliders = [document.getElementById("sliderA"), document.getElementById("sliderB")];
    const sliderState = new Map(); // el -> {value:0..1}
    sliders.forEach((el) => sliderState.set(el, { value: .5 }));

    // –†–∏—Å–æ–≤–∞–Ω–∏–µ
    let tool = "pen";
    let drawing = false;
    let hue = 0;

    // ============================ –£—Ç–∏–ª–∏—Ç—ã ============================
    const clamp = (v,a,b)=>Math.min(b,Math.max(a,v));
    const lerp = (a,b,t)=>a+(b-a)*t;

    function resizeOverlayToVideo(){
      const rect = document.getElementById("video-wrap").getBoundingClientRect();
      overlay.width = rect.width * devicePixelRatio;
      overlay.height = rect.height * devicePixelRatio;
      overlay.style.width = rect.width + "px";
      overlay.style.height = rect.height + "px";
      overlayRect = { left: rect.left + scrollX, top: rect.top + scrollY, width: rect.width, height: rect.height };
      ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
      if(drawingUtils) drawingUtils = new DrawingUtils(ctx);
    }
    addEventListener("resize", resizeOverlayToVideo);
    addEventListener("orientationchange", resizeOverlayToVideo);

    function normToPx(nx, ny){
      // –í–∏–¥–µ–æ–ø–æ—Ç–æ–∫ –∑–µ—Ä–∫–∞–ª–∏—Ç—Å—è –ø–æ X (scaleX(-1)) -> –∏–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º x
      const x = (1 - nx) * overlayRect.width;
      const y = ny * overlayRect.height;
      return { x, y };
    }

    function updateCursorVisual(progress=0){
      const deg = Math.round(clamp(progress,0,1)*360);
      cursorProgress.style.background = `conic-gradient(var(--accent3) ${deg}deg, rgba(255,255,255,.15) 0deg)`;
      cursor.style.left = `${pointerPx.x}px`;
      cursor.style.top = `${pointerPx.y}px`;
    }

    function setStatus(ok){
      detectDot.classList.toggle("ok", ok);
      detectDot.classList.toggle("err", !ok);
    }

    function setPermState(text, ok=false){
      permState.textContent = text;
      permPill.style.background = ok
        ? "linear-gradient(180deg, rgba(0,255,163,.22), rgba(0,255,163,.07))"
        : "linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02))";
      permPill.style.borderColor = ok ? "rgba(0,255,163,.35)" : "rgba(255,255,255,.08)";
    }

    // ============================ –ö–∞–º–µ—Ä–∞ ============================
    async function initCamera(){
      try{
        setPermState("–∑–∞–ø—Ä–æ—Å‚Ä¶");
        const stream = await navigator.mediaDevices.getUserMedia({
          video: {
            facingMode: "user",
            width: { ideal: 1280 }, height: { ideal: 720 }
          },
          audio: false
        });
        video.srcObject = stream;
        videoStream = stream;
        await video.play();
        vw = video.videoWidth || 1280;
        vh = video.videoHeight || 720;
        setPermState("—Ä–∞–∑—Ä–µ—à–µ–Ω–æ", true);
        fallback.classList.remove("show");
        resizeOverlayToVideo();
        return true;
      }catch(err){
        console.warn("Camera error:", err);
        setPermState("–æ—Ç–∫–ª–æ–Ω–µ–Ω–æ/–æ—à–∏–±–∫–∞");
        fallback.classList.add("show");
        return false;
      }
    }

    function stopCamera(){
      if(videoStream){
        for(const t of videoStream.getTracks()) t.stop();
        videoStream = null;
      }
      video.srcObject = null;
    }

    // ============================ –ú–æ–¥–µ–ª—å ============================
    async function initModel(){
      try{
        vision = await FilesetResolver.forVisionTasks(
          "https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest/wasm"
        );
        handLandmarker = await HandLandmarker.createFromOptions(vision, {
          baseOptions: {
            modelAssetPath:
              "https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest/wasm/hand_landmarker.task"
          },
          runningMode: "VIDEO",
          numHands: 2,
          minHandDetectionConfidence: 0.5,
          minHandPresenceConfidence: 0.5,
          minTrackingConfidence: 0.5
        });
        drawingUtils = new DrawingUtils(ctx);
        modelReady = true;
      }catch(err){
        console.error("Model load error:", err);
        alert("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –º–æ–¥–µ–ª—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Ä—É–∫. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.");
        modelReady = false;
      }
    }

    // ============================ –ñ–µ—Å—Ç—ã –∏ –ª–æ–≥–∏–∫–∞ ============================
    function getPinch(lms){
      // –¢–æ—á–∫–∏: 4 (–±–æ–ª—å—à–æ–π), 8 (—É–∫–∞–∑–∞—Ç–µ–ª—å–Ω—ã–π)
      const a = lms[4], b = lms[8];
      if(!a || !b) return {pinch:false, dist:1};
      const dx = a.x - b.x, dy = a.y - b.y;
      const dist = Math.hypot(dx,dy);
      return { pinch: dist < PINCH_TH, dist };
    }

    function countExtended(lms){
      // –ü—Ä–æ–≤–µ—Ä–∫–∞ "–∫–æ–Ω—á–∏–∫ –≤—ã—à–µ PIP" –¥–ª—è –∫–∞–∂–¥–æ–π –∏–∑ 4 –ø–∞–ª—å—Ü–µ–≤ (–∫—Ä–æ–º–µ –±–æ–ª—å—à–æ–≥–æ)
      // –ò–Ω–¥–µ–∫—Å—ã tip: 8,12,16,20; PIP: 6,10,14,18
      const pairs = [[8,6],[12,10],[16,14],[20,18]];
      let cnt = 0;
      for(const [tip,pip] of pairs){
        if(!lms[tip] || !lms[pip]) continue;
        // –ò–∑-–∑–∞ –∑–µ—Ä–∫–∞–ª–∞ –ø–æ X, –Ω–æ Y –æ—Å—Ç–∞—ë—Ç—Å—è –∫–∞–∫ –µ—Å—Ç—å: –º–µ–Ω—å—à–µ = –≤—ã—à–µ
        if(lms[tip].y < lms[pip].y) cnt++;
      }
      return cnt;
    }

    function updatePointerFromLandmarks(lms, dt){
      // –ë–µ—Ä—ë–º —É–∫–∞–∑–∞—Ç–µ–ª—å–Ω—ã–π (8) –∫–∞–∫ "–∫—É—Ä—Å–æ—Ä"
      const tip = lms[8] || lms[9] || lms[0];
      if(!tip) return;

      // –°–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ (EMA) –≤ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Ö
      pointer.x = lerp(pointer.x, tip.x, SMOOTH);
      pointer.y = lerp(pointer.y, tip.y, SMOOTH);

      // –ü–∏–∫—Å–µ–ª—å–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã overlay
      const {x, y} = normToPx(pointer.x, pointer.y);
      pointerPx.x = x;
      pointerPx.y = y;

      // —Å–∫–æ—Ä–æ—Å—Ç—å –ø–æ X –¥–ª—è —Å–≤–∞–π–ø–∞ (–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è/—Å–µ–∫)
      const vx = ((pointer.x - pointer.px) / Math.max(dt, 0.016));
      vHist.push(vx);
      if(vHist.length > 6) vHist.shift();
      pointer.px = pointer.x; pointer.py = pointer.y;
    }

    function detectSwipe(){
      if(swipeCooldown > 0) return 0;
      const avgVx = vHist.reduce((a,b)=>a+b,0)/Math.max(1,vHist.length);
      if(avgVx > SWIPE_VX){ swipeCooldown = 12; return +1; }
      if(avgVx < -SWIPE_VX){ swipeCooldown = 12; return -1; }
      return 0;
    }

    function setNav(index){
      selectedNav = (index+4)%4;
      [...gnav.children].forEach((el,i)=> el.classList.toggle("active", i===selectedNav));
      const dot = navState.querySelector(".dot");
      dot.classList.add("ok");
      navState.lastElementChild.textContent = `–¢–µ–∫—É—â–∏–π —Ä–∞–∑–¥–µ–ª: ${gnav.children[selectedNav].firstChild.textContent}`;
    }

    function processNavGestures(){
      // –ª–∞–¥–æ–Ω—å –æ—Ç–∫—Ä—ã—Ç–∞ => –ø–æ–¥—Å–≤–µ—Ç–∏—Ç—å –º–µ–Ω—é
      // –∫—É–ª–∞–∫ => —Å–≤–µ—Ä–Ω—É—Ç—å (—Å–Ω—è—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥—Å–≤–µ—Ç–∫–∏)
      if(fingersExtended >= 4){
        gnav.classList.add("pulse");
      }else{
        gnav.classList.remove("pulse");
      }
      const sw = detectSwipe();
      if(sw === 1) setNav(selectedNav+1);
      else if(sw === -1) setNav(selectedNav-1);
    }

    function rectOf(el){
      const r = el.getBoundingClientRect();
      return { x:r.left+scrollX, y:r.top+scrollY, w:r.width, h:r.height };
    }

    function inside(px, py, r, margin=0){
      return (px >= r.x-margin && px <= r.x+r.w+margin && py >= r.y-margin && py <= r.y+r.h+margin);
    }

    function updateDwellButtons(now){
      const btns = [...hoverBtns.children];
      let target = null;
      for(const b of btns){
        const r = rectOf(b);
        if(inside(pointerPx.x, pointerPx.y, r, 0)){
          target = b; break;
        }
      }
      if(target !== dwellTarget){
        dwellTarget = target;
        dwellStart = now;
        updateCursorVisual(0);
      }else if(dwellTarget){
        const p = clamp((now - dwellStart)/DWELL_MS, 0, 1);
        updateCursorVisual(p);
        if(p >= 1){
          dwellTarget.classList.toggle("active");
          const action = dwellTarget.dataset.action;
          logBtn(`–ö–Ω–æ–ø–∫–∞ ¬´${action}¬ª –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞`);
          dwellStart = now + 1e6; // –ø—Ä–æ—Å—Ç–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è
        }
      }else{
        updateCursorVisual(0);
      }
    }

    function logBtn(text){
      btnLog.lastElementChild.textContent = text;
      const dot = btnLog.querySelector(".dot");
      dot.classList.add("ok");
      setTimeout(()=>dot.classList.remove("ok"), 600);
    }

    function valueFromTrack(x, trackEl){
      const r = rectOf(trackEl);
      const v = clamp((x - r.x) / Math.max(1, r.w), 0, 1);
      return v;
    }

    function nearestSlider(px, py){
      let minD = Infinity, best = null;
      for(const el of sliders){
        const r = rectOf(el);
        // —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ —Ü–µ–Ω—Ç—Ä–∞ —Ç—Ä–µ–∫–∞
        const track = el.querySelector(".track");
        const tr = rectOf(track);
        const cx = clamp(px, tr.x, tr.x+tr.w);
        const cy = tr.y + tr.h/2;
        const d = Math.hypot(px-cx, py-cy);
        if(d < minD){ minD = d; best = {el, track, tr}; }
      }
      return (minD < NEAR_PX) ? best : null;
    }

    function applySlider(el, v){
      const st = sliderState.get(el);
      st.value = v;
      const track = el.querySelector(".track");
      const fill = track.querySelector(".fill");
      const thumb = track.querySelector(".thumb");
      const val = el.querySelector(".val");
      fill.style.insetInlineEnd = `${Math.round((1-v)*100)}%`;
      const tr = track.getBoundingClientRect();
      thumb.style.left = `${v*tr.width}px`;
      val.textContent = `${Math.round(v*100)}%`;

      // –ø–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã: –Ω–∞ –ª–µ—Ç—É –º–µ–Ω—è–µ–º —Ñ–æ–Ω –¥–µ–º–æ
      if(el.id === "sliderA"){
        // —è—Ä–∫–æ—Å—Ç—å: –æ—Ç 0.8 –¥–æ 1.2
        const br = 0.8 + v*0.4;
        document.body.style.filter = `brightness(${br}) saturate(${0.8 + sliderState.get(sliders[1]).value*0.8})`;
      }
    }

    function drawStroke(prev, curr, width, color, erase=false){
      dctx.lineJoin = dctx.lineCap = "round";
      dctx.globalCompositeOperation = erase ? "destination-out" : "source-over";
      dctx.strokeStyle = color;
      dctx.lineWidth = width;
      dctx.beginPath();
      dctx.moveTo(prev.x, prev.y);
      dctx.lineTo(curr.x, curr.y);
      dctx.stroke();
      dctx.globalCompositeOperation = "source-over";
    }

    function processDrawing(){
      // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∫—É—Ä—Å–æ—Ä–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ canvas —Ä–∏—Å–æ–≤–∞–Ω–∏—è
      const r = rectOf(drawCanvas);
      const x = clamp(pointerPx.x - r.x, 0, r.w);
      const y = clamp(pointerPx.y - r.y, 0, r.h);

      // –ù–∞—á–∞—Ç—å/–∑–∞–∫–æ–Ω—á–∏—Ç—å —Ä–∏—Å–æ–≤–∞–Ω–∏–µ –ø–æ –ø–∏–Ω—á—É
      if(pinch && inside(pointerPx.x, pointerPx.y, r, 0)){
        if(!drawing){
          drawing = true;
          dctx.beginPath();
        }else{
          // –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π —à—Ç—Ä–∏—Ö
          const prev = processDrawing.prev || { x, y };
          // –≤—ã–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
          let width = 4, color = "#fff", erase=false;
          if(tool === "pen"){ width = 4; color = "#fff"; }
          else if(tool === "high"){ width = 10; color = "rgba(124,92,255,.8)"; }
          else if(tool === "rainbow"){ width = 8; hue = (hue+4)%360; color = `hsl(${hue} 100% 60%)`; }
          else if(tool === "erase"){ width = 24; erase = true; }

          drawStroke(prev, {x,y}, width, color, erase);
          processDrawing.prev = { x, y };
        }
      }else{
        drawing = false;
        processDrawing.prev = null;
      }
    }

    function setTool(t){
      tool = t;
      document.querySelectorAll(".tool").forEach(el=> el.classList.toggle("active", el.dataset.tool===t));
      if(t === "clear"){
        dctx.clearRect(0,0,drawCanvas.width, drawCanvas.height);
        setTool("pen");
      }
    }
    document.querySelectorAll(".tool").forEach(el=>{
      el.addEventListener("click", ()=> setTool(el.dataset.tool));
    });

    // ============================ –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª ============================
    let frames = 0, lastFpsT = performance.now();

    async function tick(now){
      if(!running){ requestAnimationFrame(tick); return; }
      const dt = Math.min(0.1, (now - (lastT || now))/1000);
      lastT = now;
      if(swipeCooldown>0) swipeCooldown--;

      // –û—á–∏—Å—Ç–∫–∞ –æ–≤–µ—Ä–ª–µ—è
      ctx.clearRect(0,0,overlay.width, overlay.height);

      let hands = 0;

      if(modelReady && (video.readyState >= 2) && !mouseMode){
        const res = handLandmarker.detectForVideo(video, now);
        hands = res?.landmarks?.length || 0;
        if(hands > 0){
          setStatus(true);
          handsInfo.textContent = `–†—É–∫–∏: ${hands}`;
          // –†–∏—Å—É–µ–º –∏ –±–µ—Ä—ë–º –ø–µ—Ä–≤—É—é —Ä—É–∫—É –∫–∞–∫ —É–ø—Ä–∞–≤–ª—è—é—â—É—é
          const lms = res.landmarks[0];
          drawingUtils.drawConnectors(lms, HandLandmarker.HAND_CONNECTIONS, { color: "#00d1ff", lineWidth: 3 });
          drawingUtils.drawLandmarks(lms, { color: "#00ffa3", lineWidth: 1, radius: 3 });

          // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—É—Ä—Å–æ—Ä–∞
          updatePointerFromLandmarks(lms, dt);

          // –î–µ—Ç–µ–∫—Ü–∏—è –ø–∏–Ω—á–∞/–∫–æ–ª-–≤–∞ –ø–∞–ª—å—Ü–µ–≤
          const {pinch: p} = getPinch(lms);
          pinch = p;
          fingersExtended = countExtended(lms);
        }else{
          setStatus(false);
          handsInfo.textContent = `–†—É–∫–∏: 0`;
        }
      }

      // –í–∏–∑—É–∞–ª –∫—É—Ä—Å–æ—Ä–∞
      updateCursorVisual(dwellTarget ? clamp((now-dwellStart)/DWELL_MS,0,1) : 0);

      // –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å
      processNavGestures();
      updateDwellButtons(now);

      // –†–∞–±–æ—Ç–∞—Ç—å —Å–æ —Å–ª–∞–π–¥–µ—Ä–∞–º–∏ (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–∏–Ω—á–µ)
      if(pinch){
        const near = nearestSlider(pointerPx.x, pointerPx.y);
        if(near){
          const v = valueFromTrack(pointerPx.x, near.track);
          applySlider(near.el, v);
        }
      }

      // –†–∏—Å–æ–≤–∞–Ω–∏–µ
      processDrawing();

      // –°—Ç–∞–≤–∏–º –∫—É—Ä—Å–æ—Ä –ø–æ–≤–µ—Ä—Ö, —Å–∫—Ä—ã–≤–∞–µ–º –ø—Ä–∏ –º—ã—à–∏–Ω–æ–º —Ä–µ–∂–∏–º–µ –µ—Å–ª–∏ –Ω–µ –¥–≤–∏–≥–∞–µ—Ç—Å—è
      cursor.classList.toggle("hidden", mouseMode && !mouseMovedRecently());

      // FPS
      frames++;
      if(now - lastFpsT >= 500){
        const fps = Math.round(frames * 1000 / (now - lastFpsT));
        fpsEl.textContent = fps + " FPS";
        lastFpsT = now; frames = 0;
      }

      requestAnimationFrame(tick);
    }

    // ============================ –ú—ã—à–∏–Ω—ã–π —Ä–µ–∂–∏–º (fallback) ============================
    let mouseLastMove = 0;
    function mouseMovedRecently(){ return performance.now() - mouseLastMove < 1500; }
    function enableMouseMode(on){
      mouseMode = on;
      toggleMouseBtn.textContent = on ? "–ö–∞–º–µ—Ä–∞ + –º—ã—à—å" : "–†–µ–∂–∏–º –º—ã—à–∏";
      document.body.classList.toggle("mouse-on", on);
    }
    addEventListener("mousemove", (e)=>{
      if(!mouseMode) return;
      mouseLastMove = performance.now();
      // –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º –≤ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Ö overlay
      const nx = clamp((e.clientX - overlayRect.left) / Math.max(1, overlayRect.width), 0, 1);
      const ny = clamp((e.clientY - overlayRect.top) / Math.max(1, overlayRect.height), 0, 1);
      pointer.x = nx; pointer.y = ny;
      const p = normToPx(nx, ny);
      pointerPx = p;
      updateCursorVisual(0);
    });
    addEventListener("mousedown", ()=> { if(mouseMode){ pinch = true; } });
    addEventListener("mouseup", ()=> { if(mouseMode){ pinch = false; drawing = false; } });

    // ============================ –°–∏—Å—Ç–µ–º–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ ============================
    toggleCamBtn.addEventListener("click", ()=>{
      if(videoStream){ stopCamera(); toggleCamBtn.textContent = "–í–∫–ª—é—á–∏—Ç—å –∫–∞–º–µ—Ä—É"; }
      else { initCamera(); toggleCamBtn.textContent = "–û—Ç–∫–ª—é—á–∏—Ç—å –∫–∞–º–µ—Ä—É"; }
    });
    toggleMouseBtn.addEventListener("click", ()=> enableMouseMode(!mouseMode));
    askPermBtn.addEventListener("click", initCamera);
    enableMouseFallback.addEventListener("click", ()=> { enableMouseMode(true); fallback.classList.remove("show"); });

    // –ö–ª–∏–∫–∏ –ø–æ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
    gnav.addEventListener("click", (e)=>{
      const item = e.target.closest(".gitem");
      if(!item) return;
      setNav(parseInt(item.dataset.index,10));
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–ª–∞–π–¥–µ—Ä–æ–≤
    sliders.forEach(el=> applySlider(el, sliderState.get(el).value));

    // –ê–¥–∞–ø—Ç–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ —Ö–æ–ª—Å—Ç–∞ –ø–æ–¥ CSS-—Ä–∞–∑–º–µ—Ä
    function resizeDrawCanvas(){
      const r = drawCanvas.getBoundingClientRect();
      drawCanvas.width = Math.floor(r.width * devicePixelRatio);
      drawCanvas.height = Math.floor(r.height * devicePixelRatio);
      // —É–¥–æ–±–Ω–æ —Ä–∏—Å–æ–≤–∞—Ç—å –≤ CSS-px, –Ω–æ –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –æ—Å—Ç–∞–≤–∏–º –º–∞—Å—à—Ç–∞–± 1:1 —á–µ—Ä–µ–∑ transform
      dctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
    }
    resizeDrawCanvas();
    addEventListener("resize", resizeDrawCanvas);

    // ============================ –°—Ç–∞—Ä—Ç ============================
    (async function start(){
      // –ï—Å–ª–∏ –Ω–µ—Ç –∫–∞–º–µ—Ä—ã ‚Äî –Ω–µ –ø–∞–¥–∞–µ–º, –ø—Ä–µ–¥–ª–æ–∂–∏–º fallback
      await initModel();
      const camOk = await initCamera();
      if(!camOk){
        fallback.classList.add("show");
      }
      resizeOverlayToVideo();
      initialized = true;
      requestAnimationFrame(tick);
    })();
  </script>

  <!-- –ù–µ–±–æ–ª—å—à–æ–π —Å–∫—Ä–∏–ø—Ç –±–µ–∑ –º–æ–¥—É–ª–µ–π: —É–∫—Ä–∞—à–µ–Ω–∏—è –∏ –∑–∞—â–∏—Ç–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ -->
  <script>
    // –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Ä–∞–¥–∏ ‚Äì –ø—Ä–æ–≤–µ—Ä–∏–º –ø–æ–¥–¥–µ—Ä–∂–∫—É API
    (function(){
      const ok = !!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia);
      if(!ok){
        const fb = document.getElementById("fallback");
        if(fb){ fb.classList.add("show"); fb.querySelector(".box p").textContent = "–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π Chrome/Edge/Safari/Firefox –∏–ª–∏ –≤–∫–ª—é—á–∏—Ç–µ —Ä–µ–∂–∏–º –º—ã—à–∏."; }
      }
    })();
  </script>
</body>
</html>
